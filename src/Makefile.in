#################################################################
# Infernal
# src Makefile
# SVN $Id$
#################################################################
# @LICENSE@
#################################################################

SHELL  = /bin/sh

## your compiler and compiler flags
#
CC     = @CC@
CFLAGS = @CFLAGS@

## other defined flags. 
#  DEFS contains stuff that autoconf decides on. 
#  LIBS contains system libraries that the configure script decides we need.
#
DEFS  = @DEFS@
LIBS  = @LIBS@ -lm

## archiving command, and ranlib command if you need one.
#  In general, you shouldn't need to change these, and they're
#  only used for building the testsuite anyway... e.g. we
#  make a "libinfernal.a" library for building the testsuite.
#
AR     = @AR@ rcv 
RANLIB = @RANLIB@

# configuration for optional MPI functionality
MPILIBS   = @MPILIBS@

# Where the build arena is (module .h and .o files)
#
MYLIBS   = -leasel 
MYLIBDIR = -L../easel 
MYINCDIR = -I../easel 

PROGS = cmalign cmbuild cmemit cmscore cmsearch cmstat

OBJS  = alphabet.o\
	bandcyk.o\
	cm.o\
	cmio.o\
	cm_cluster.o\
	cm_dispatch.o\
	cm_eweight.o\
	cm_errors.o\
	cm_fastalign.o\
	cm_fastsearch.o\
	cm_masks.o\
	cm_mx.o\
	cm_searchinfo.o\
	cm_cp9_hybridsearch.o\
	cplan9.o\
	CP9_cm2wrhmm.o\
	CP9_scan.o\
	cp9_fastsearch.o\
	cp9_mx.o\
	display.o\
	emit.o\
	emitmap.o\
	hmmband.o\
	logsum.o\
	modelconfig.o\
	modelmaker.o\
	mpisupport.o\
	parsetree.o\
	prior.o\
	rnamat.o\
	smallcyk.o\
	sub_cm.o\
	stats.o

HDRS  = funcs.h\
	structs.h

.c.o: 
	$(CC) $(CFLAGS) $(DEFS) $(MYINCDIR) -c $<

#################################################################
## Targets defining how to make INFERNAL executables.
##
all: 	$(PROGS) 

$(PROGS): @EXEC_DEPENDENCY@ $(OBJS) ${HDRS}
	$(CC) $(CFLAGS) $(DEFS) $(MYLIBDIR) -o $@ $@.o $(OBJS) $(MYLIBS) $(LIBS) $(MPILIBS)


#################################################################
## Targets used in making INFERNAL module for testsuite compilation.
##
module: libinfernal.a

libinfernal.a: $(OBJS) ${HDRS}
	$(AR) libinfernal.a $(OBJS) 
	$(RANLIB) libinfernal.a
	chmod 644 libinfernal.a


#################################################################
## Miscellaneous targets.
##
clean:
	-rm -f *.o *~ Makefile.bak core $(PROGS) TAGS gmon.out libinfernal.a

distclean:
	-rm -f *.o *~ Makefile.bak core $(PROGS) TAGS gmon.out libinfernal.a
	-rm -f Makefile config.h

TAGS:
	etags -t *.c *.h Makefile.in

