#################################################################
# Infernal
# src Makefile
# SVN $Id$
#################################################################
# @LICENSE@
#################################################################

SHELL  = /bin/sh

## your compiler and compiler flags
#
CC     = @CC@
CFLAGS = @CFLAGS@

## other defined flags. 
#  DEFS contains stuff that autoconf decides on. 
#  LIBS contains system libraries that the configure script decides we need.
#
DEFS  = @DEFS@
LIBS  = @LIBS@ 

## archiving command, and ranlib command if you need one.
#  In general, you shouldn't need to change these, and they're
#  only used for building the testsuite anyway... e.g. we
#  make a "libinfernal.a" library for building the testsuite.
#
AR     = @AR@ rcv 
RANLIB = @RANLIB@

# configuration for optional MPI functionality
MPICC     = @MPICC@
MPILIBS   = @MPILIBS@
MPIPROGS  = @MPIPROGS@

# Where the build arena is (module .h and .o files)
#
MYLIBS   = -leasel 
MYLIBDIR = -L../easel 
MYINCDIR = -I../easel 

PROGS = cmalign cmbuild cmcalibrate cmemit cmscore cmsearch cmstat

OBJS  = alphabet.o\
	bandcyk.o\
	cm.o\
	cmio.o\
	display.o\
	emit.o\
	emitmap.o\
	modelconfig.o\
	modelmaker.o\
	parsetree.o\
	prior.o\
	scancyk.o\
	smallcyk.o\
	truncyk.o\
	cm_eweight.o\
	hmmband.o\
	hbandcyk.o\
	cplan9.o\
	CP9_cm2wrhmm.o\
	CP9_scan.o\
	cm_postprob.o\
	scaninside.o\
	cm_masks.o\
	sub_cm.o\
	stats.o\
	mpifuncs.o\
	cm_dispatch.o\
	rnamat.o\
	cm_cluster.o\
	cm_errors.o

HDRS  = funcs.h\
	prior.h\
	structs.h\
	hmmband.h\
	cplan9.h\
	cm_postprob.h\
	stats.h\
	mpifuncs.h

.c.o: 
	$(CC) $(CFLAGS) $(DEFS) $(MYINCDIR) -c $<

#################################################################
## Targets defining how to make INFERNAL executables.
##
all: 	$(PROGS) $(MPIPROGS)

$(PROGS): @EXEC_DEPENDENCY@ $(OBJS) ${HDRS}
	$(CC) $(CFLAGS) $(DEFS) $(MYLIBDIR) -o $@ $@.o $(OBJS) $(MYLIBS) $(LIBS)

mpi-cmalign: cmalign.c $(OBJS) ${HDRS}
	$(CC) -DMPI_EXECUTABLE $(CFLAGS) $(DEFS) $(MYINCDIR) -c cmalign.c
	$(CC) -DMPI_EXECUTABLE $(CFLAGS) $(DEFS) $(MYLIBDIR) -o mpi-cmalign cmalign.o $(OBJS) $(MYLIBS) $(LIBS)

mpi-cmsearch: cmsearch.c $(OBJS) ${HDRS}
	$(CC) -DMPI_EXECUTABLE $(CFLAGS) $(DEFS) $(MYINCDIR) -c cmsearch.c
	$(CC) -DMPI_EXECUTABLE $(CFLAGS) $(DEFS) $(MYLIBDIR) -o mpi-cmsearch cmsearch.o $(OBJS) $(MYLIBS) $(LIBS)

mpi-cmcalibrate: cmcalibrate.c $(OBJS) ${HDRS}
	$(CC) -DMPI_EXECUTABLE $(CFLAGS) $(DEFS) $(MYINCDIR) -c cmcalibrate.c
	$(CC) -DMPI_EXECUTABLE $(CFLAGS) $(DEFS) $(MYLIBDIR) -o mpi-cmcalibrate cmcalibrate.o $(OBJS) $(MYLIBS) $(LIBS)


#################################################################
## Targets used in making INFERNAL module for testsuite compilation.
##
module: libinfernal.a

libinfernal.a: $(OBJS) ${HDRS}
	$(AR) libinfernal.a $(OBJS) 
	$(RANLIB) libinfernal.a
	chmod 644 libinfernal.a


#################################################################
## Miscellaneous targets.
##
clean:
	-rm -f *.o *~ Makefile.bak core $(PROGS) $(MPIPROGS) TAGS gmon.out libinfernal.a

distclean:
	-rm -f *.o *~ Makefile.bak core $(PROGS) $(MPIPROGS) TAGS gmon.out libinfernal.a
	-rm -f Makefile config.h

TAGS:
	etags -t *.c *.h Makefile.in

