Checklist for an Infernal release.
SRE, Mon Oct 31 07:40:36 2005 
-------------------------------------

Infernal has an "unstable trunk" policy. A release goes on a stable
branch.

When editing this 00CHECKLIST, it is best to edit it only in the
trunk, not in a release branch. It isn't included in releases anyway.



1. Announce the intent to release to all developers. 
   All working copies of Infernal and its dependent libraries (ssdk,
   squid, easel) should be committed. 
   Example of checking for stray or uncommitted files:
	 ./configure
         make distclean
         svn update
	 svn status
   Clean up any stray files identified by 'svn status'.
   'svn add' and 'svn commit' as needed to commit new or modified files.

2. Test the trunk first. 
   Compile should be entirely clean when compiled -Wall.
   'make check' should be clean, and 'make dist' should work.

        ./configure --enable-debugging --enable-lfs --enable-mpi --prefix=/groups/eddy/home/eddys/tmp/infernal
        make
        make check
        make dist	

3. If creating a new major release, create a stable release branch for all packages.
   All subsequent bugfix releases will happen in this branch, while trunk keeps moving.
   [Query replace the version # here]
         svn copy https://svn.janelia.org/eddylab/eddys/src/infernal/trunk\
                 https://svn.janelia.org/eddylab/eddys/src/infernal/branches/0.8\
                 -m "created 0.8 release branch"          
         svn copy https://svn.janelia.org/eddylab/eddys/src/squid/trunk\
                 https://svn.janelia.org/eddylab/eddys/src/squid/branches/infernal/0.8\
                 -m "created Infernal 0.8 release branch"          
         svn copy https://svn.janelia.org/eddylab/eddys/src/ssdk/trunk\
                 https://svn.janelia.org/eddylab/eddys/src/ssdk/branches/infernal/0.8\
                 -m "created Infernal 0.8 release branch"          
         svn copy https://svn.janelia.org/eddylab/eddys/easel/trunk\
                 https://svn.janelia.org/eddylab/eddys/easel/branches/infernal/0.8\
                 -m "created Infernal 0.8 release branch"          

   If you're making minor bugfixes for a stable release branch that already exists,
   do nothing at this step.

4. Check out a working copy of the release branch.
   Don't call this working directory infernal-xx, just call it infernal, because
   later "make dist" is going to try to create infernal-xx as its release.
   [Query replace the version # here]

         cd ~/releases
         svn checkout https://svn.janelia.org/eddylab/eddys/src/infernal/branches/release-0.8 infernal
         (cd infernal/testsuite/; ln -s ../ssdk/sqc .)

   If this is the first time (a new release branch), you also need to update the "svn:externals"
   so the dependent packages are checked out from the appropriate stable branches too.

         svn proplist --verbose https://svn.janelia.org/eddylab/eddys/src/infernal/branches/release-0.8
         svn propedit svn:externals infernal
           squid   https://svn.janelia.org/eddylab/eddys/src/squid/branches/infernal/0.8
           ssdk    https://svn.janelia.org/eddylab/eddys/src/ssdk/branches/infernal/0.8
           easel   https://svn.janelia.org/eddylab/eddys/easel/branches/infernal/0.8
         cd infernal
         svn update

   Now you will switch to working *only* in this release branch working copy.
   Make no more changes in the trunk (except for this file, 00CHECKLIST) 
   We'll merge bugfixes back into the trunk once we've stabilized the release.

   Note the hassle with svn:externals, because it currently only accepts
   absolute URLs. Relative paths are supposed to become available in
   Subversion 1.5, which may help.


5. Test.
   The infernal testsuite is currently relatively weak. It needs to include
   valgrind tests for memory leaks, for example.

   But even so, don't rely solely on the automated exercises and bug tests.
   Run some anecdotal examples by hand too.

    	 autoconf; (cd squid; autoconf); (cd easel; autoconf)
     	 env CFLAGS="-g -Wall" ./configure --enable-mpi --enable-lfs --prefix=/groups/eddy/home/eddys/tmp/infernal
         make
         make check

   Make a new DicF model in this version's format, for
   backwards compatibility testing:
         cd testsuite
         ../src/cmbuild DicF-$RELEASE.cm DicF.seed
         svn add DicF-$RELEASE.cm
   Add a line to exercises.sqc.

   Run some anecdotes. Examples:
        ../src/cmbuild foo.cm ../intro/trna.sto
        ../src/cmsearch foo.cm trna-regression.fa
   Run those with valgrind, too.

   Check the User's Guide.
      cd documentation/userguide
      make


6. Write release notes.
   For the first time on a new release branch, it's handy to look
   at the svn log. Replace "1534" below with the last release's SVN rev.
	 svn log -r 1534:HEAD | more
         emacs documentation/release-notes/RELEASE-${RELEASE}
	 svn add documentation/release-notes/RELEASE-${RELEASE}

                 sre/src                sre/easel
   Release   from-rev   to-rev      from-rev    to-rev    
   -------   --------   ------      --------    ------
   0.6:       875        1477          ?          72
   0.7:       1477       1534         72          84
   0.71:      1534       1725         84         139
   0.72:      1725       1862        139         149
   0.8:       1862       1968        149         174
       0.81 - bugfix release on 0.8 branch

   Note that we aren't using the release notes anywhere right now!
   But we will, undoubtedly, someday.

7. Update the copyright, year stamps. 
	- configure.ac (release, relcode, date)
	- COPYRIGHT (year only)


8. Commit to SVN; include release number in the log message
	 svn commit
    Remember to separately commit in Easel, squid, ssdk if any
    changes were made there.

9. Tag.
         svn copy https://svn.janelia.org/eddylab/eddys/src/infernal/branches/0.8\
                  https://svn.janelia.org/eddylab/eddys/src/infernal/tags/0.81\
                 -m "tagged Infernal 0.81 release, from 0.8 stable branch"          
         svn copy https://svn.janelia.org/eddylab/eddys/src/squid/branches/infernal/0.8\
                  https://svn.janelia.org/eddylab/eddys/src/squid/tags/infernal/0.81\
                 -m "tagged Infernal 0.81 release, from 0.8 stable branch"          
         svn copy https://svn.janelia.org/eddylab/eddys/src/ssdk/branches/infernal/0.8\
                  https://svn.janelia.org/eddylab/eddys/src/ssdk/tags/infernal/0.81\
                 -m "tagged Infernal 0.81 release, from 0.8 stable branch"          
         svn copy https://svn.janelia.org/eddylab/eddys/easel/branches/infernal/0.8\
	          https://svn.janelia.org/eddylab/eddys/easel/tags/infernal/0.81\
                 -m "tagged Infernal 0.81 release, from 0.8 stable branch"          

10. Make a distribution tarball.
   (Remaking configure scripts w/ autoconf is needed)
	 make distclean
         autoconf; (cd easel; autoconf); (cd squid; autoconf)
	 ./configure          <-- makes a Makefile (needed for "make dist")
	 make dist
          [or: 'make -n dist' and execute commands yourself one at a
           time, under a Bourne shell like 'bash' so the for loops
           work.]

   This exports into a infernal-$RELEASE directory, alongside the
   infernal working directory in ~/releases/. The tarball is also
   left in ~/releases/.
   
   Go into infernal-$RELEASE and make sure it looks good from the 
   perspective of a new user: start by reading the README's.

11. Build for our system (on login-eddy)
         ssh login-eddy
	 cd releases/infernal-xxx
	 env CFLAGS="-O3" ./configure --enable-mpi --enable-lfs --prefix=/usr/local/infernal-0.8/
	 make
	 make check
         (cd testsuite; ./sqc -p ../squid/ -r ../../infernal-0.52/src 4 regressions.sqc ../src/)
                                                  ^^^^ replace w/ latest old version
         
   Didn't run regressions at the 0.71 or later releases. Need to leave
   old release in the releases subdir for the regressions test above to work.

   Currently, I don't have permission to install software on login-eddy, so 
   just email Goran at this point.


12. Put on the FTP site. (on selab)
          scp 00README                selab:/opt/www/ftp/pub/software/infernal/
          scp COPYRIGHT               selab:/opt/www/ftp/pub/software/infernal/
          scp Userguide.pdf           selab:/opt/www/ftp/pub/software/infernal/
          scp ../infernal-0.81.tar.gz selab:/opt/www/ftp/pub/software/infernal/
          ssh selab  rm -f /opt/www/ftp/pub/software/infernal/infernal.tar.gz
          ssh selab  "(cd /opt/www/ftp/pub/software/infernal; ln -s infernal-0.81.tar.gz infernal.tar.gz)"

13. Update the web site
	 cd ~/web/infernal/
         emacs index.html 
         make
	 texclean
         svn commit

14. Clean up. Don't remove the old directory though, we will (should) use it for regression testing 
    at the next release.
	cd ~/releases
        mv infernal-0.81.tar.gz ~/Archive/
        cd infernal
	make distclean

15. Merge the changes from the "stabilized" release branch back into the trunk.

    If you're doing a minor bugfix release on a stable branch, you know the
    revs that introduced the bugfixes; merge them explicitly. For example:
       cd ~/src/infernal
       svn update
       svn merge -r 1990:1992 https://svn.janelia.org/eddylab/eddys/src/infernal/branches/0.8
    
    If you're doing a major release on a new stable branch:
    First identify the rev #'s for when we made the release branch.
    In the release working copy:
       svn log --verbose --stop-on-copy      <-- ssdk, squid are the same
       cd easel
       svn log --verbose --stop-on-copy 
           infernal   squid      ssdk   easel
    0.6:  (r1465; Easel is r72.)
    0.7:  (r1522; Easel is r81.)
    0.71: (r1723; Easel is r139.)
    0.8:   r1966       r1967     r1968   r173

    Go back to working copies of the trunks, and merge the release branches into it.
       cd ~/src/infernal
       svn update
       svn merge -r 1966:HEAD https://svn.janelia.org/eddylab/eddys/src/infernal/branches/release-0.8

       cd squid
       svn update
       svn merge -r 1967:HEAD https://svn.janelia.org/eddylab/eddys/src/squid/branches/infernal/0.8

       cd ../ssdk
       svn update
       svn merge -r 1968:HEAD https://svn.janelia.org/eddylab/eddys/src/ssdk/branches/infernal/0.8

       cd ../easel
       svn update
       svn merge -r 173:HEAD https://svn.janelia.org/eddylab/eddys/easel/branches/infernal/0.8
       
    Now, the merge will always screw up the svn:externals for Infernal. Reset them.
       cd ..
       svn propedit svn:externals .
          squid   https://svn.janelia.org/eddylab/eddys/src/squid/trunk
          ssdk    https://svn.janelia.org/eddylab/eddys/src/ssdk/trunk
          easel   https://svn.janelia.org/eddylab/eddys/easel/trunk

    Commits.
       svn commit 
       ( cd squid ; svn commit )
       ( cd ssdk  ; svn commit )
       ( cd easel ; svn commit )

0.3  - SRE, Thu Jul  4 10:27:16 2002
0.5  - SRE, Sun Oct  6 14:22:47 2002
0.51 - SRE, Wed Oct  9 09:43:50 2002
0.52 - SRE, Mon Oct 14 2002
0.53 - SRE, Thu Jan  2 14:24:07 2003
0.54 - SRE, Sun Jan  5 18:17:55 2003
0.55 - SRE, Wed Apr  2 18:12:23 2003   r875
0.6  - SRE, Tue Nov  1 17:13:00 2005   r1477  Easel:r72
0.7  - SRE, Tue Dec 13 14:54:30 2005   r1534  Easel:r84
0.71 - SRE, Thu Nov 30 11:43:57 2006   r1730  Easel:r142
0.72 - SRE, Sat Jan 27 10:44:46 2007   r1862  Easel:r149
0.8  - SRE, Sun Apr 29 11:55:56 2007   r1984  Easel:r176
0.81 - SRE, Tue May  1 10:36:10 2007   r1995  Easel:r179


